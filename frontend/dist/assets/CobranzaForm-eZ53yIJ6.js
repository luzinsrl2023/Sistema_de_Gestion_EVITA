import{y as $,u as q,v as A,R as T,t as E,r as x,j as e,f as r,z as L}from"./index-BzKEmjXo.js";import{u as z}from"./usePagos-Ciu4jx_k.js";import{u as W}from"./useRecibos-BERc-e1S.js";function _(g){var b;const{facturaId:f}=$(),j=q(),v=A(),a=g.invoice||((b=j.state)==null?void 0:b.invoice)||{id:f,client:"Cliente",total:0,pendingAmount:void 0},{data:h=[],addPago:N}=z(),{addRecibo:w}=W(),C=T.useMemo(()=>h.filter(t=>t.invoiceId===a.id).reduce((t,s)=>t+Number(s.amount||0),0),[h,a.id]),P=Math.max(0,Number(a.total||0)-C),o=a.pendingAmount??P,u=g.onClose||(()=>v(-1)),{updateFactura:S}=E(),[l,m]=x.useState(""),[i,F]=x.useState("efectivo"),[c,R]=x.useState(new Date().toISOString().split("T")[0]),k=()=>{try{const t=localStorage.getItem("evita-recibo-seq"),s=t?parseInt(t,10):0,n=isNaN(s)?1:s+1;return localStorage.setItem("evita-recibo-seq",String(n)),`RC-${String(n).padStart(6,"0")}`}catch{return`RC-${Date.now()}`}},p=async t=>{if(!t||t<=0)return;const s=Number(o),n=Math.min(t,s),d=Math.max(0,s-n),D=d<=0?"pagado":"parcial";await N({invoiceId:a.id,client:a.client,amount:n,method:i,date:c}),await S(a.id,{status:D});const y=k();try{await w({id:y,fecha:c,cliente:a.client,facturaId:a.id,metodo:i,monto:n,saldo:d})}catch{}await L({reciboId:y,fecha:c,cliente:a.client,facturaId:a.id,metodo:i,importe:r(n),saldo:r(d),filename:`recibo-${a.id}-${c}.pdf`}),alert(`Pago registrado: ${r(n)} por ${i}. Restante: ${r(d)}`),u()},M=async t=>{t.preventDefault();const s=parseFloat(l);isNaN(s)||await p(s)},I=async()=>{const t=Number(o);let s=parseFloat(l);(isNaN(s)||s>=t)&&(s=Math.max(.01,Number((t/2).toFixed(2)))),await p(s)};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-3xl font-bold text-white",children:"Registrar Pago"}),e.jsx("button",{onClick:u,className:"p-2 text-gray-400 hover:text-white hover:bg-gray-800 rounded-lg transition-colors",children:e.jsx(B,{className:"h-5 w-5"})})]}),e.jsx("div",{className:"bg-gray-900 border border-gray-800 rounded-xl p-6",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-400",children:"Factura"}),e.jsx("p",{className:"text-white font-medium",children:a.id})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-400",children:"Cliente"}),e.jsx("p",{className:"text-white font-medium",children:a.client})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-400",children:"Total Factura"}),e.jsx("p",{className:"text-white font-medium",children:r(a.total)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-400",children:"Pendiente"}),e.jsx("p",{className:"text-white font-medium",children:r(o)})]})]}),e.jsxs("form",{onSubmit:M,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-white mb-2",children:"Monto a Pagar"}),e.jsx("input",{type:"number",step:"0.01",required:!0,value:l,onChange:t=>m(t.target.value),className:"w-full bg-gray-800 border border-gray-700 rounded-lg px-4 py-2 text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-green-500",placeholder:"0.00"}),e.jsxs("div",{className:"flex items-center justify-between mt-2",children:[e.jsxs("div",{className:"text-xs text-gray-400",children:["Saldo restante: ",e.jsx("span",{className:"font-medium text-white",children:r(Math.max(0,Number(o)-(parseFloat(l||"0")||0)))})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"button",onClick:()=>m(String(Number(o).toFixed(2))),className:"px-2 py-1 text-xs bg-gray-800 hover:bg-gray-700 text-gray-200 rounded",children:"Usar pendiente"}),e.jsx("button",{type:"button",onClick:()=>m(String((Number(o)/2).toFixed(2))),className:"px-2 py-1 text-xs bg-gray-800 hover:bg-gray-700 text-gray-200 rounded",children:"50%"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-white mb-2",children:"Método de Pago"}),e.jsxs("select",{value:i,onChange:t=>F(t.target.value),className:"w-full bg-gray-800 border border-gray-700 rounded-lg px-4 py-2 text-white focus:outline-none focus:ring-2 focus:ring-green-500",children:[e.jsx("option",{value:"efectivo",children:"Efectivo"}),e.jsx("option",{value:"transferencia",children:"Transferencia"}),e.jsx("option",{value:"mercado-pago",children:"Mercado Pago"}),e.jsx("option",{value:"tarjeta",children:"Tarjeta de Crédito/Débito"}),e.jsx("option",{value:"cheque",children:"Cheque"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-white mb-2",children:"Fecha de Pago"}),e.jsx("input",{type:"date",required:!0,value:c,onChange:t=>R(t.target.value),className:"w-full bg-gray-800 border border-gray-700 rounded-lg px-4 py-2 text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-green-500"})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 flex-wrap",children:[e.jsx("button",{type:"button",onClick:u,className:"px-6 py-2 bg-gray-700 hover:bg-gray-600 text-white rounded-lg font-medium transition-colors",children:"Cancelar"}),e.jsx("button",{type:"button",onClick:I,className:"px-6 py-2 bg-yellow-600 hover:bg-yellow-700 text-white rounded-lg font-medium transition-colors",children:"Registrar pago parcial"}),e.jsx("button",{type:"submit",className:"px-6 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg font-medium transition-colors",children:"Registrar Pago"})]})]})]})})]})}function B(){return e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),e.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})}export{_ as default};
