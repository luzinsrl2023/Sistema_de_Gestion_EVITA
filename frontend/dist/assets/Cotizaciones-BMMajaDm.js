import{N as C,h as $,O as z,r as x,j as e,n as S,Q as F,D,P as I,T,x as P}from"./index-BzKEmjXo.js";function j(){try{const i=localStorage.getItem("evita-cotizacion-seq"),m=i?parseInt(i,10):0,o=isNaN(m)?1:m+1;return localStorage.setItem("evita-cotizacion-seq",String(o)),`COT-${String(o).padStart(6,"0")}`}catch{return`COT-${Date.now()}`}}function E(){const{data:i=[],addCotizacion:m}=C(),{data:o=[]}=$(),{data:h=[]}=z(),[l,y]=x.useState({nombre:"",email:""}),[d,g]=x.useState({fecha:new Date().toISOString().slice(0,10),validezDias:15,notas:""}),[c,p]=x.useState([{id:1,nombre:"",cantidad:1,precio:0}]),n=x.useMemo(()=>{const a=c.reduce((r,u)=>r+(Number(u.cantidad)||0)*(Number(u.precio)||0),0),s=+(a*.21).toFixed(2),t=+(a+s).toFixed(2);return{subtotal:a,iva:s,total:t}},[c]);function N(){p(a=>[...a,{id:Date.now(),nombre:"",cantidad:1,precio:0}])}function v(a){p(s=>s.length>1?s.filter(t=>t.id!==a):s)}function b(a,s){p(t=>t.map(r=>r.id===a?{...r,...s}:r))}async function f(){const a=j(),s={id:a,cliente:l,fecha:d.fecha,validezDias:d.validezDias,notas:d.notas,items:c,totales:n};await m(s),alert(`Cotización ${a} guardada`)}async function w(){const a=j(),s=["Producto","Cantidad","Precio Unit.","Subtotal"],t=c.map(r=>[r.nombre||"-",String(r.cantidad||0),`$ ${Number(r.precio||0).toFixed(2)}`,`$ ${(Number(r.cantidad||0)*Number(r.precio||0)).toFixed(2)}`]);t.push([{text:"Subtotal",colSpan:3,alignment:"right"},{},{},`$ ${n.subtotal.toFixed(2)}`]),t.push([{text:"IVA 21%",colSpan:3,alignment:"right"},{},{},`$ ${n.iva.toFixed(2)}`]),t.push([{text:"TOTAL",colSpan:3,alignment:"right",bold:!0},{},{},{text:`$ ${n.total.toFixed(2)}`,bold:!0}]),await P({title:`Cotización ${a}`,sections:[{title:`Cliente: ${l.nombre||"-"}`,head:[],body:[[{text:`Email: ${l.email||"-"}`}],[{text:`Fecha: ${d.fecha}`}],[{text:`Validez: ${d.validezDias} días`}],...d.notas?[[{text:`Notas: ${d.notas}`}]]:[]]},{title:"Detalle",head:s,body:t}],filename:`${a}.pdf`,brand:"EVITA",subtitle:"Cotización de productos"})}return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h1",{className:"text-xl font-semibold flex items-center gap-2",children:[e.jsx(S,{className:"h-5 w-5"})," Cotizaciones"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:f,className:"inline-flex items-center gap-2 px-3 py-2 rounded-lg bg-gray-800 text-white hover:bg-gray-700",children:[e.jsx(F,{className:"h-4 w-4"}),"Guardar"]}),e.jsxs("button",{onClick:w,className:"inline-flex items-center gap-2 px-3 py-2 rounded-lg bg-indigo-600 text-white hover:bg-indigo-500",children:[e.jsx(D,{className:"h-4 w-4"}),"PDF"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-gray-900/40 p-4 rounded-lg border border-gray-800",children:[e.jsx("h2",{className:"font-medium mb-3",children:"Cliente"}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("input",{list:"clientes-list",className:"w-full px-3 py-2 rounded-md bg-gray-900 border border-gray-700",placeholder:"Buscar cliente",value:l.nombre,onChange:a=>{const s=a.target.value,t=o.find(r=>r.name===s);y(r=>({...r,nombre:s,email:(t==null?void 0:t.email)||r.email}))}}),e.jsx("datalist",{id:"clientes-list",children:o.map(a=>e.jsx("option",{value:a.name},a.id))}),e.jsx("input",{className:"w-full px-3 py-2 rounded-md bg-gray-900 border border-gray-700",placeholder:"Email",value:l.email,onChange:a=>y(s=>({...s,email:a.target.value}))})]})]}),e.jsxs("div",{className:"bg-gray-900/40 p-4 rounded-lg border border-gray-800",children:[e.jsx("h2",{className:"font-medium mb-3",children:"Datos"}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("input",{type:"date",className:"w-full px-3 py-2 rounded-md bg-gray-900 border border-gray-700",value:d.fecha,onChange:a=>g(s=>({...s,fecha:a.target.value}))}),e.jsx("input",{type:"number",className:"w-full px-3 py-2 rounded-md bg-gray-900 border border-gray-700",placeholder:"Validez (días)",value:d.validezDias,onChange:a=>g(s=>({...s,validezDias:Number(a.target.value)}))}),e.jsx("textarea",{className:"w-full px-3 py-2 rounded-md bg-gray-900 border border-gray-700",placeholder:"Notas",value:d.notas,onChange:a=>g(s=>({...s,notas:a.target.value}))})]})]}),e.jsxs("div",{className:"bg-gray-900/40 p-4 rounded-lg border border-gray-800",children:[e.jsx("h2",{className:"font-medium mb-3",children:"Totales"}),e.jsxs("div",{className:"space-y-2 text-sm text-gray-300",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Subtotal"}),e.jsxs("span",{children:["$ ",n.subtotal.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"IVA (21%)"}),e.jsxs("span",{children:["$ ",n.iva.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between font-semibold text-white",children:[e.jsx("span",{children:"Total"}),e.jsxs("span",{children:["$ ",n.total.toFixed(2)]})]})]})]})]}),e.jsxs("div",{className:"bg-gray-900/40 p-4 rounded-lg border border-gray-800",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h2",{className:"font-medium",children:"Ítems"}),e.jsxs("button",{onClick:N,className:"inline-flex items-center gap-2 px-3 py-2 rounded-md border border-gray-700 hover:bg-gray-800",children:[e.jsx(I,{className:"h-4 w-4"}),"Agregar"]})]}),e.jsx("div",{className:"space-y-2",children:c.map(a=>e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-12 gap-2 items-center",children:[e.jsx("input",{list:"productos-list",className:"md:col-span-6 px-3 py-2 rounded-md bg-gray-900 border border-gray-700",placeholder:"Producto",value:a.nombre,onChange:s=>{const t=s.target.value,r=h.find(u=>u.name===t);b(a.id,{nombre:t,precio:(r==null?void 0:r.price)??a.precio})}}),e.jsx("datalist",{id:"productos-list",children:h.map(s=>e.jsx("option",{value:s.name},s.id))}),e.jsx("input",{type:"number",min:"1",className:"md:col-span-2 px-3 py-2 rounded-md bg-gray-900 border border-gray-700",placeholder:"Cantidad",value:a.cantidad,onChange:s=>b(a.id,{cantidad:Number(s.target.value)})}),e.jsx("input",{type:"number",step:"0.01",className:"md:col-span-2 px-3 py-2 rounded-md bg-gray-900 border border-gray-700",placeholder:"Precio",value:a.precio,onChange:s=>b(a.id,{precio:Number(s.target.value)})}),e.jsxs("div",{className:"md:col-span-1 text-right text-sm",children:["$ ",((Number(a.cantidad)||0)*(Number(a.precio)||0)).toFixed(2)]}),e.jsx("button",{onClick:()=>v(a.id),className:"md:col-span-1 w-full md:w-auto inline-flex items-center justify-center p-2 rounded-md border border-gray-700 hover:bg-gray-800 text-red-400",children:e.jsx(T,{className:"h-4 w-4"})})]},a.id))})]}),i.length>0&&e.jsxs("div",{className:"bg-gray-900/40 p-4 rounded-lg border border-gray-800",children:[e.jsx("h2",{className:"font-medium mb-2",children:"Últimas cotizaciones"}),e.jsx("div",{className:"text-sm text-gray-300 space-y-1",children:i.slice(-5).reverse().map(a=>{var s,t;return e.jsxs("div",{className:"flex justify-between border-b border-gray-800 pb-1",children:[e.jsxs("span",{children:[a.id," · ",((s=a.cliente)==null?void 0:s.nombre)||"-"," · ",a.fecha]}),e.jsxs("span",{children:["$ ",Number(((t=a.totales)==null?void 0:t.total)||0).toFixed(2)]})]},a.id)})})]})]})}export{E as default};
